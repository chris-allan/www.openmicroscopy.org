language: ruby
sudo: required

services:
- docker

script:
  - docker run -it --rm -v $PWD:/srv/jekyll -eJEKYLL_UID=$UID jekyll/builder:pages jekyll build --config _config.yml,_prod.yml
  - docker run -it  --rm -v $(pwd)/_site:/site -it jekyll/builder:pages /usr/gem/bin/htmlproofer /site --disable-external
  - tar -zcvf wwww.openmicroscopy.org.tar.gz _site

deploy:
  provider: releases
  api_key: $GITHUB_OAUTH_TOKEN
  file: wwww.openmicroscopy.org.tar.gz
  skip_cleanup: true
  on:
    tags: true
